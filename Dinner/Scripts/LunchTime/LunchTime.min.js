define("require.config",[],function(){return{getConfig:function(e,r,s){var n=new Date,t="cache="+n.getFullYear()+"-"+n.getMonth()+"-"+n.getDate();return{baseUrl:e,urlArgs:t,waitSeconds:600,shim:{jquery:{exports:"jQuery"},underscore:{exports:"_"},bootstrap:{deps:["jquery"]},angular:{exports:"angular",deps:["jquery"]},"angular-resource":{deps:["angular"]},"angular-route":{deps:["angular"]},"angular-bootstrap":{deps:["angular"]},"angular-sanitize":{deps:["angular"]},"angular-locale":{deps:["angular"]},"angular-touch":{deps:["angular"]},ladda:{deps:["jquery","spin"]},spin:{deps:["jquery"]},glisse:{deps:["jquery"]},plupload:{exports:"plupload"}},paths:{angular:r+"/angular/angular","angular-resource":r+"/angular/angular-resource","angular-route":r+"/angular/angular-route","angular-sanitize":r+"/angular/angular-sanitize","angular-locale":r+"/angular/i18n/angular-locale_ru-ru","angular-touch":r+"/angular/angular-touch",bootstrap:r+"/bootstrap/bootstrap","angular-bootstrap":r+"/bootstrap/ui-bootstrap-tpls",jquery:r+"/jquery/jquery","jquery-form":r+"/jquery/jquery.form",underscore:r+"/underscore/underscore",text:r+"/require/text",ladda:r+"/ladda/ladda",spin:r+"/spin/spin",moment:r+"/moment/moment",toastr:r+"/toastr/toastr",plupload:r+"/plupload/plupload.full.min",glisse:r+"/glisse/glisse",framework:s}}}}}),define("application.config",[],function(){var e="/",r="/Images",s=e+"Api",n="1";return{defaultCompanyId:n,urls:{application:e,api:{baseUrl:s,courseThumbnail:s+"/coursepicture/thumbnail?companyid="+n+"&courseid={0}",coursePicture:s+"/coursepicture/image?companyid="+n+"&courseid={0}"},views:{},images:{images:r,categoriesIcons:r+"/CourseType/"}},dialogOptions:{backdrop:!0,keyboard:!0,backdropClick:!0,dialogFade:!1},plugins:{plupload:{runtimes:"html5,flash,silverlight,html4",flash_swf_url:"/scripts/Libs/plupload/Moxie.swf",silverlight_xap_url:"/scripts/Libs/plupload/Moxie.xap",mimeTypes:{image:{title:"Image files",extensions:"jpg,gif,png"}}},glisse:{speed:500,effect:"bounce"}}}}),define("application.routes",[],function(){var e=["$routeProvider","$locationProvider","config",function(e,r,s){var n=s.urls.application;e.otherwise({redirectTo:n}),r.html5Mode(!0)}];return e}),define("application.providers",[],function(){var e=["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}];return e}),define("application.events",[],function(){var e={};return e}),define("application.start",["underscore","application.events"],function(){var e={};return e}),define("framework/extensions/string.extensions",[],function(){String.prototype.format||(String.prototype.format=function(){for(var e=this,r=arguments.length;r--;)e=e.replace(new RegExp("\\{"+r+"\\}","gm"),arguments[r]);return e}),String.isNullOrEmpty||(String.isNullOrEmpty=function(e){return e&&0!==e.length?!1:!0})}),define("framework/extensions/boolean.extensions",[],function(){Boolean.parse||(Boolean.parse=function(e){if("string"==typeof e&&0===e.length)throw Error("Boolean.parse: Cannot convert empty string to boolean.");switch(e.toLowerCase()){case"true":return!0;case"false":return!1;default:throw Error('Boolean.parse: Cannot convert string "'+e+'" to boolean.')}})}),define("framework/extensions/extensions",["framework/extensions/string.extensions","framework/extensions/boolean.extensions"],function(){}),define("framework/assert",["underscore","framework/extensions/extensions"],function(e){var r={isNotNull:function(e,r,s){if(void 0===e||null===e){var n=s||(r?'"{0}" cannot be undefined.':"Specified value cannot be undefined.");throw new Error(n.format(r))}return this},isFunction:function(r,s,n){if(!e.isFunction(r)){var t=n||(s?'"{0}" is not a function.':"Specified value is not a function.");throw new Error(t.format(s))}return this},isString:function(r,s,n){if(!e.isString(r)){var t=n||(s?'"{0}" is not a string.':"Specified value is not a string.");throw new Error(t.format(s))}return this},isArray:function(r,s,n){if(!e.isArray(r)){var t=n||(s?'"{0}" is not a array.':"Specified value is not a array.");throw new Error(t.format(s))}return this},isObject:function(r,s,n){if(!e.isObject(r)){var t=n||(s?'"{0}" is not a object.':"Specified value is not a object.");throw new Error(t.format(s))}return this},isNumber:function(r,s,n){if(!e.isNumber(r)){var t=n||(s?'"{0}" is not a number.':"Specified value is not a number.");throw new Error(t.format(s))}return this},isTrue:function(e,r,s){if(!e){var n=s||(r?'"{0}" is not a "true".':'Specified value is not a "true".');throw new Error(n.format(r))}return this},isFalse:function(e,r,s){if(e){var n=s||(r?'"{0}" is not a "false".':'Specified value is not a "false".');throw new Error(n.format(r))}return this},isMatch:function(e,r,s,n){if(!r.test(e)){var t=n||(s?'"{0}" is not match pattern.':"Specified value is not match pattern.");throw new Error(t.format(s))}return this}};return r}),define("framework/utils",["jquery","underscore","framework/extensions/extensions"],function(e,r){var s={},n=[];return s.toArray=function(e,r){return r=r||0,n.slice.call(e,r)},s.extend=function(e,n,t){return t?s.extendRecurcive(e,n):r.extend(e,n)},s.extendRecurcive=function(e,n){var t=function(e){return r.isObject(e)&&!r.isArray(e)},i=function(e){return!r.isUndefined(e)&&!r.isNull(e)};for(var o in n)n.hasOwnProperty(o)&&i(n[o])&&(i(e[o])?t(n[o])&&s.extendRecurcive(e[o],n[o]):e[o]=n[o]);return e},s.merge=function(){for(var e={},s=0;s<arguments.length;s++)r.extend(e,arguments[s]);return e},s.escape=function(r){var s=e("<div/>").text(r).html();return s},s.invoke=function(e,r,s){switch(s=s||[],r?-1:s.length){case 0:return e();case 1:return e(s[0]);case 2:return e(s[0],s[1]);case 3:return e(s[0],s[1],s[2]);case 4:return e(s[0],s[1],s[2],s[3]);case 5:return e(s[0],s[1],s[2],s[3],s[4]);case 6:return e(s[0],s[1],s[2],s[3],s[4],s[5]);case 7:return e(s[0],s[1],s[2],s[3],s[4],s[5],s[6]);case 8:return e(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]);case 9:return e(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8]);case 10:return e(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9]);default:return e.apply(r,s)}},s.invokeActions=function(e){r.forEach(e||[],function(e){s.invoke(e.operation,e.context,e.args)})},s.instantiate=function(e,n){var t=function(){};t.prototype=e.prototype;var i=new t,o=s.invoke(e,i,n),u=r.isObject(o)?o:i;return u},s.isEmptyGuid=function(e){var r="00000000-0000-0000-0000-000000000000",s=!e||e===r;return s},s.date={parseJson:function(e){return new Date(parseInt(e.substr(6),10))}},s.string={random:function(e,r){r=r||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var s="",n=0;e>n;n++){var t=Math.floor(Math.random()*r.length);s+=r.substring(t,t+1)}return s},getHash:function(e){var r=0;if(0==e.length)return r;for(var s=0;s<e.length;s++){var n=e.charCodeAt(s);r=(r<<5)-r+n,r&=r}return r},getHashIgnoringCase:function(e){var r=0;if(0==e.length)return r;e=e.toLowerCase();for(var s=0;s<e.length;s++){var n=e.charCodeAt(s);r=(r<<5)-r+n,r&=r}return r},isEndsWith:function(e,r){return e=e||"",r.length>e.length?!1:0===e.length&&0===r.length?!0:e.substring(e.length-r.length,e.length)===r},isStartsWith:function(e,r){return e=e||"",r.length>e.length?!1:e.substring(0,r.length)===r},trimEnd:function(e,r){return e=e||"",s.string.isEndsWith(e,r)?e.substring(0,e.length-r.length):e},trimStart:function(e,r){return e=e||"",s.string.isStartsWith(e,r)?e.substring(r.length,e.length):e},trimWhitespace:function(e){return e=e||"",e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},equals:function(e,r){return e=e||"",r=r||"",e==r},equalsIgnoreCase:function(e,r){return e=e||"",r=r||"",e.toLowerCase()==r.toLowerCase()}},s.array={without:function(e,r){var s=e.indexOf(r);-1!==s&&e.splice(s,1)}},s.formatParametesCollection=function(e,s){var n=[];return r.each(s,function(r,s){for(var t in r)if(r.hasOwnProperty(t)){var i=r[t],o="{0}[{1}].{2}".format(e,s,t);n.push({name:o,value:i})}}),n},s}),define("framework/class",["framework/assert","framework/utils"],function(e,r){var s=function(e,r,n){return s.create(e,r,n)};return s.create=function(e,s,n){return e=e||function(){},s&&r.extend(e.prototype,s),n&&r.extend(e,n),e},s.inherit=function(s,n,t,i){e.isNotNull(s,"parent");var o={};return r.extend(o,s.prototype),t&&r.extend(o,t),n=n||function(){},n.prototype=o,r.extend(n,s),i&&r.extend(n,i),n.prototype.constructor=n,n},s.extend=function(e,n){var t=this===s?function(){}:this;e=e||{},n=n||{};var i=e.hasOwnProperty("constructor")?e.constructor:function(){var e=r.toArray(arguments);t.prototype.constructor.apply(this,e)},o=s.inherit(t,i,e,n);return o.extend=s.extend,o},s.implement=function(e,r,n,t){var i=function(){};return i.prototype=e,s.inherit(i,r,n,t)},s}),define("core/controllers/confirmController",["underscore","framework/class","framework/assert","framework/utils"],function(e,r,s,n){var t=["$scope","$modalInstance","data",r.create(function(e,r,s){this.$scope=n.extend(e,this.$scope,!0),this.$modalInstance=r,this.initialize(s)},{$scope:{data:null},$modalInstance:null,initialize:function(r){this.$scope.data=r,this.$scope.confirm=e.bind(this.confirm,this),this.$scope.closeDialog=e.bind(this.closeDialog,this)},confirm:function(){this.$modalInstance.close()},closeDialog:function(){this.$modalInstance.dismiss()}})];return t}),define("core/controllers/controllers",["angular","core/controllers/confirmController"],function(e,r){var s=[],n=e.module("lunchtime.core.controllers",s);return n.controller("confirmController",r),n}),define("core/services/services",["angular"],function(e){var r=[],s=e.module("lunchtime.core.services",r);return s}),define("core/filters/formatTimeSpanFilter",["framework/assert"],function(e){var r=[function(){return function(r){e.isNotNull(r,"time"),e.isNumber(r.hours,"hours"),e.isNumber(r.minutes,"minutes");var s=function(e){var r=10>e?"0{0}":"{0}";return r.format(e)};return"{0}:{1}".format(s(r.hours),s(r.minutes))}}];return r}),define("core/filters/filters",["angular","core/filters/formatTimeSpanFilter"],function(e,r){var s=[],n=e.module("lunchtime.core.filters",s);return n.filter("formatTimeSpan",r),n}),define("core/directives/isLoading",["jquery","ladda"],function(e,r){var s=[function(){return{restrict:"A",link:function(e,s,n){var t=r.create(s[0]);e.$watch(n.isLoading,function(e){e?t.start():t.stop()})}}}];return s}),define("core/directives/toggle",[],function(){var e=["$parse",function(e){return{restrict:"A",link:function(r,s,n){var t=e(n.toggle),i=t.assign;s.on("click",function(){var e=!!t(r);i(r,!e)})}}}];return e}),define("core/directives/fileUpload",["underscore","plupload","framework/utils"],function(e,r,s){var n=["config",function(e){return{restrict:"A",scope:{uploadUrl:"@",uploadParams:"=",onUploadError:"&?",onFilesAdded:"&?",onFileUploaded:"&?",onFileUploadProgress:"&?"},controller:["$scope",function(e){this.upload=function(){e.uploader.start()}}],require:"^form",link:function(n,t,i,o){var u={runtimes:e.plugins.plupload.runtimes,flash_swf_url:e.plugins.plupload.flash_swf_url,silverlight_xap_url:e.plugins.plupload.silverlight_xap_url,filters:{},url:n.uploadUrl};if(i.browseButton)u.browse_button=i.browseButton;else{var a=i.id;a||(a=s.string.random(32),t.attr("id",a)),u.browse_button=a}if(i.maxFileSize&&(u.filters.max_file_size=i.maxFileSize),i.mimeType){var c=e.plugins.plupload.mimeTypes[i.mimeType];u.filters.mime_types=[c]}n.uploadParams&&(u.multipart=!0,u.multipart_params=n.uploadParams);var l=new r.Uploader(u);n.uploader=l,l.init(),l.bind("Error",function(e,r){n.onUploadError&&n.$apply(function(){n.onUploadError({error:r})}),e.refresh()}),l.bind("FilesAdded",function(e,r){n.onFilesAdded&&n.$apply(function(){n.onFilesAdded({files:r})}),"true"===i.autoUpload?l.start():n.$apply(function(){o.$setDirty()})}),l.bind("FileUploaded",function(e,r,s){n.onFileUploaded&&n.$apply(function(){n.onFileUploaded({file:r,response:s}),o.$setDirty()})}),l.bind("UploadProgress",function(e,r){n.onFileUploadProgress&&n.$apply(function(){n.onFileUploadProgress({file:r,percent:r.percent})})})}}}];return n}),define("core/directives/fileUploadPreviewImage",[],function(){var e=[function(){return{restrict:"A",scope:{file:"="},link:function(e,r){e.$watch("file",function(e){if(e){var s=new FileReader;s.onload=function(e){r.attr("src",e.target.result)},s.readAsDataURL(e.getNative())}})}}}];return e}),define("core/directives/popoverHtml",[],function(){var e=["$compile","$timeout","$parse","$window","$tooltip",function(e,r,s,n,t){return t("popoverHtml","popover","click")}];return e}),define("core/directives/popoverHtmlPopup",[],function(){var e=[function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover-html.html"}}];return e}),define("core/directives/srcBig",["jquery","glisse"],function(e){var r=["config",function(r){return{restrict:"A",scope:null,link:function(s,n,t){var i=e(n[0]),o=t.srcBig;i.attr("data-glisse-big",o),i.glisse(r.plugins.glisse)}}}];return r}),define("core/directives/directives",["angular","core/directives/isLoading","core/directives/toggle","core/directives/fileUpload","core/directives/fileUploadPreviewImage","core/directives/popoverHtml","core/directives/popoverHtmlPopup","core/directives/srcBig"],function(e,r,s,n,t,i,o,u){var a=["ui.bootstrap"],c=e.module("lunchtime.core.directives",a);return c.directive("isLoading",r),c.directive("toggle",s),c.directive("fileUpload",n),c.directive("fileUploadPreviewImage",t),c.directive("popoverHtml",i),c.directive("popoverHtmlPopup",o),c.directive("srcBig",u),c}),define("core/providers/qDecorator",[],function(){var e=["$delegate",function(e){return e.rejectAsync=function(r){var s=e.reject(r);return{then:s.then,"catch":function(e){return s.then(null,e),s},"finally":function(e){return s.then(null,e),s}}},e}];return e}),define("core/providers/providers",["angular","core/providers/qDecorator"],function(e,r){var s=[],n=e.module("lunchtime.core.providers",s);return n.config(["$provide",function(e){e.decorator("$q",r)}]),n}),define("text!core/templates/popoverHtml.tmpl.html",[],function(){return'<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\r\n    <div class="arrow"></div>\r\n    <div class="popover-inner">\r\n        <h3 class="popover-title" ng-bind="title" ng-show="title"></h3>\r\n        <div class="popover-content" bind-html-unsafe="content"></div>\r\n    </div>\r\n</div>'}),define("core/templates/templates",["angular","text!core/templates/popoverHtml.tmpl.html"],function(e,r){var s=[],n=e.module("lunchtime.core.templates",s);return n.run(["$templateCache",function(e){e.put("template/popover/popover-html.html",r)}]),n}),define("core/core",["angular","core/controllers/controllers","core/services/services","core/filters/filters","core/directives/directives","core/providers/providers","core/templates/templates"],function(e,r,s,n,t,i,o){var u=[r.name,s.name,n.name,t.name,i.name,o.name],a=e.module("lunchtime.core",u);return a}),define("common/controllers/controllers",["angular"],function(e){var r=[],s=e.module("lunchtime.common.controllers",r);return s}),define("common/models/category",["framework/assert"],function(e){var r=function(r,s){e.isNotNull(r,"id"),e.isNotNull(s,"name"),this.id=r,this.name=s};return r}),define("common/models/categories",[],function(){var e={salad:0,soup:1,meat:2,garnish:3,other:4};return e}),define("common/services/categoryService",["underscore","angular","framework/assert","common/models/category","common/models/categories"],function(e,r,s,n,t){var i=[function(){return{getCategories:function(){return[new n(t.salad,"Салаты"),new n(t.soup,"Супы"),new n(t.meat,"Основные блюда"),new n(t.garnish,"Гарниры"),new n(t.other,"Другое")]},getCategoriesMap:function(){return{salad:this.getCategoryById(t.salad),soup:this.getCategoryById(t.soup),meat:this.getCategoryById(t.meat),garnish:this.getCategoryById(t.garnish),other:this.getCategoryById(t.other)}},getCategoryById:function(r){s.isNotNull(r,"id");var n=this.getCategories(),t=e.find(n,function(e){return e.id===r});if(!t)throw new Error('Category with id "{0}" not found.'.format(r));return t},isHalfPortionsAllowed:function(e){switch(s.isNotNull(e,"category"),e.id){case t.salad:return!1;case t.soup:return!0;case t.meat:return!1;case t.garnish:return!0;case t.other:return!1;default:throw new Error('Half portions restrictions for category with id "{0}" not found.'.format(e.id))}}}}];return i}),define("common/models/categoryMenu",["framework/assert"],function(e){var r=function(r,s){e.isNotNull(r,"category"),e.isNotNull(s,"courses"),e.isArray(s,"courses"),this.category=r,this.courses=s};return r}),define("common/services/menuService",["underscore","framework/assert","common/models/categoryMenu"],function(e,r,s){var n=["categoryService",function(n){return{groupCoursesByCategories:function(t){r.isArray(t,"courses");var i=e.chain(t).groupBy(function(e){return e.category.id}).pairs().map(function(r){var t=parseInt(r[0],10),i=e.sortBy(r[1],function(e){return e.name}),o=n.getCategoryById(t);return new s(o,i)}).sortBy(function(e){return e.category.id}).value();return i},updateCategoriesMenus:function(r,s){var n={};e.each(r,function(e){e.courses=[],n[e.category.id]=e}),e.each(s,function(e){var r=n[e.category.id];r.courses.push(e)})}}}];return n}),define("common/models/course",["framework/assert"],function(e){var r=function(r,s,n,t,i,o,u,a,c){e.isNotNull(r,"id"),e.isNotNull(s,"name"),e.isNotNull(n,"price"),e.isNumber(n,"price"),e.isNotNull(t,"category"),e.isNotNull(i,"menuItemId"),e.isNotNull(o,"maxOrders"),e.isNumber(o,"maxOrders"),e.isNotNull(u,"ordersCount"),e.isNumber(u,"ordersCount"),this.id=r,this.name=s,this.price=n,this.category=t,this.menuItemId=i,this.maxOrders=o,this.ordersCount=u,this.description=a||"",this.weight=c||""};return r}),define("common/services/commonApiMappingService",["common/models/course"],function(e){var r=["categoryService",function(r){return{mapResponseToCourse:function(s){var n=r.getCategoryById(s.CategoryType),t=new e(s.ID,s.Name,s.Price,n,s.MenuItemID||0,s.MaxOrders||0,s.OrderedQuantity||0,s.Description,s.Weight);return t}}}];return r}),define("common/services/services",["angular","common/services/categoryService","common/services/menuService","common/services/commonApiMappingService"],function(e,r,s,n){var t=[],i=e.module("lunchtime.common.services",t);return i.service("categoryService",r),i.service("menuService",s),i.service("commonApiMappingService",n),i}),define("common/filters/weight",[],function(){var e=[function(){return function(e){return e?"{0} гр.".format(e):e}}];return e}),define("common/filters/filters",["angular","common/filters/weight"],function(e,r){var s=[],n=e.module("lunchtime.common.filters",s);return n.filter("weight",r),n}),define("text!common/templates/menuCategoryTitle.tmpl.html",[],function(){return'<h3 class="uppercase">\r\n    <lt:category-icon category="category"></lt:category-icon>\r\n    {{category.name}}\r\n</h3>'}),define("text!common/templates/categoryIcon.tmpl.html",[],function(){return'<img ng-src="{{categoryIconUrl}}" alt="{{category.name}}" class="img-circle course-category-icon" />'}),define("common/templates/templates",["angular","text!common/templates/menuCategoryTitle.tmpl.html","text!common/templates/categoryIcon.tmpl.html"],function(e,r,s){var n=[],t=e.module("lunchtime.common.templates",n);return t.run(["$templateCache",function(e){e.put("/templates/common/menuCategoryTitle.tmpl",r),e.put("/templates/common/categoryIcon.tmpl",s)}]),t}),define("common/directives/menuCategoryTitle",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/templates/common/menuCategoryTitle.tmpl",scope:{category:"="}}}];return e}),define("common/directives/categoryIcon",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/templates/common/categoryIcon.tmpl",scope:{category:"="},controller:["$scope","config",function(e,r){var s;switch(e.category.id){case 0:s="salad.png";break;case 1:s="soup.png";break;case 2:s="meat.png";break;case 3:s="garnish.png";break;case 4:s="misc.png";break;default:throw new Error("Unknown category id: {0}.".format(e.category.id))}e.categoryIconUrl=r.urls.images.categoriesIcons+s}]}}];return e}),define("common/directives/directives",["angular","common/templates/templates","common/directives/menuCategoryTitle","common/directives/categoryIcon"],function(e,r,s,n){var t=[r.name],i=e.module("lunchtime.common.directives",t);return i.directive("ltMenuCategoryTitle",s),i.directive("ltCategoryIcon",n),i}),define("common/providers/providers",["angular"],function(e){var r=[],s=e.module("lunchtime.common.providers",r);return s}),define("common/common",["angular","common/controllers/controllers","common/services/services","common/filters/filters","common/directives/directives","common/providers/providers","common/templates/templates"],function(e,r,s,n,t,i,o){var u=[r.name,s.name,n.name,t.name,i.name,o.name],a=e.module("lunchtime.common",u);return a}),define("user/user.config",["application.config","common/models/categories"],function(e,r){var s="/Menu/Index",n="/Api/Menu";return{urls:{application:s,api:{getCoursesAndOrders:n+"/GetCoursesAndOrders",getCourses:n+"/GetCourses",orderCourse:n+"/OrderCourse",removeOrder:n+"/RemoveOrder",moveOrderToBox:n+"/MoveOrderToBox",wishCourse:n+"/WishCourse",unwishCourse:n+"/UnwishCourse",coursePicture:e.urls.api.coursePicture,courseThumbnail:e.urls.api.courseThumbnail},views:{menuView:"/template/user/menu.tmpl",anonymousMenuView:"/template/user/menu/anonymous.tmpl"}},restrictions:{maxBoxCount:5,boxingAllowedCategories:[r.soup,r.meat,r.garnish]}}}),define("user/user.routes",[],function(){var e=["$routeProvider","$locationProvider","user.config",function(e,r,s){var n=s.urls.application,t=s.urls.views;e.when(n+"/:date?",{templateUrl:t.menuView,controller:"userManageOrdersController",resolve:{menuData:["userMenuApiService","$route",function(e,r){var s=r.current.params.date;if(!s){var n=new Date,t=n.getDay()>=5?8-n.getDay():1;s=n.setDate(n.getDate()+t)}var i=e.getCoursesAndOrders(s);return i}]}})}];return e}),define("user/menu/controllers/userManageOrdersController",["underscore","framework/class","framework/assert","framework/utils","toastr"],function(e,r,s,n,t){var i=["$scope","userMenuApiService","orderService","menuData",r.create(function(e,r,s,t){this.$scope=n.extend(e,angular.copy(this.$scope),!0),this.userMenuApiService=r,this.orderService=s,this.initialize(t)},{$scope:{date:null,isFreezed:null,freezeTime:null,courses:[],orders:[],wishedCourses:[]},userMenuApiService:null,orderService:null,initialize:function(r){s.isNotNull(r,"menuData"),this.$scope.date=r.date,this.$scope.isFreezed=r.isFreezed,this.$scope.freezeTime=r.freezeTime,this.$scope.courses=r.courses,this.$scope.orders=r.orders,this.$scope.wishedCourses=r.wishedCourses,this.$scope.orderCourse=e.bind(this.orderCourse,this),this.$scope.removeOrder=e.bind(this.removeOrder,this),this.$scope.moveOrderToBox=e.bind(this.moveOrderToBox,this)},orderCourse:function(r,n){s.isNotNull(r,"course"),s.isNotNull(n,"quantity");var t=this.userMenuApiService.orderCourse(r,n,this.$scope.date);return t.then(e.bind(function(e){this.$scope.orders=this.orderService.addNewOrderToCollection(this.$scope.orders,e),r.ordersCount+=n},this),e.bind(this._onFail,this)),t},removeOrder:function(r){s.isNotNull(r,"order");var n=this.userMenuApiService.removeOrder(r,this.$scope.date);return n.then(e.bind(function(){this.$scope.orders=this.orderService.removeOrderFromCollection(this.$scope.orders,r),r.course.ordersCount-=r.quantity},this),e.bind(this._onFail,this)),n},moveOrderToBox:function(r,n){s.isNotNull(r,"order"),s.isNotNull(n,"box");var t=this.userMenuApiService.moveOrderToBox(r,n,this.$scope.date);return t.then(e.bind(function(e){var s=this.orderService.removeOrderFromCollection(this.$scope.orders,r);s=this.orderService.addNewOrderToCollection(s,e),this.$scope.orders=s},this),e.bind(this._onFail,this)),t},_onFail:function(e){t.error(e)}})];return i}),define("user/menu/controllers/anonymousUserMenuController",["underscore","framework/class","framework/assert","framework/utils"],function(e,r,s,n){var t=["$scope","menuData",r.create(function(e,r){this.$scope=n.extend(e,angular.copy(this.$scope),!0),this.initialize(r)},{$scope:{date:null,courses:[]},initialize:function(e){s.isNotNull(e,"menuData"),this.$scope.date=e.date,this.$scope.courses=e.courses}})];return t}),define("user/menu/controllers/menu/userMenuController",["angular","underscore","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","userMenuService","menuService","userMenuApiService",s.create(function(r,s,n,i){this.$scope=t.extend(r,e.copy(this.$scope),!0),this.userMenuService=s,this.menuService=n,this.userMenuApiService=i,this.initialize()},{$scope:{date:null,isFreezed:null,courses:[],categoriesMenu:[],wishedCourses:[]},userMenuService:null,menuService:null,userMenuApiService:null,initialize:function(){this.$scope.$watch("courses",r.bind(this._onCoursesUpdated,this)),this.$scope.orderCourse=r.bind(this.orderCourse,this),this.$scope.hasWished=r.bind(this.hasWished,this),this.$scope.wishCourse=r.bind(this.wishCourse,this)},hasWished:function(e){n.isNotNull(e,"course");var s=r.some(this.$scope.wishedCourses,function(r){return r.id===e.id});return s},wishCourse:function(e){n.isNotNull(e,"course");var s,i=function(){t.array.without(this.$scope.wishedCourses,e)},o=function(){var s=r.find(this.$scope.wishedCourses,function(r){return r.category.id===e.category.id});s&&t.array.without(this.$scope.wishedCourses,s),this.$scope.wishedCourses.push(e)},u=this.hasWished(e);return s=u?this.userMenuApiService.unwishCourse(e,this.$scope.date).then(r.bind(i,this)):this.userMenuApiService.wishCourse(e,this.$scope.date).then(r.bind(o,this))},orderCourse:function(e,r){return n.isNotNull(e,"course"),n.isNotNull(r,"quantity"),this.$scope.onOrderCourse({course:e,quantity:r})},_onCoursesUpdated:function(e){n.isNotNull(e,"courses"),n.isArray(e,"courses"),this.$scope.categoriesMenu=this.menuService.groupCoursesByCategories(e)}})];return i}),define("user/menu/controllers/menu/userMenuCourseController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","user.config","userMenuService",s.create(function(e,s,n){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.userConfig=s,this.userMenuService=n,this.initialize()},{$scope:{course:null,isFreezed:null,isWished:null,orderOptions:null,defaultOption:null,courseImage:{url:null,thumbnailUrl:null},state:{isOrdering:!1,isWishing:!1}},userConfig:null,userMenuService:null,initialize:function(){this.$scope.courseImage.url=this.userConfig.urls.api.coursePicture.format(this.$scope.course.id),this.$scope.courseImage.thumbnailUrl=this.userConfig.urls.api.courseThumbnail.format(this.$scope.course.id),this.$scope.orderCourse=e.bind(this.orderCourse,this),this.$scope.wishCourse=e.bind(this.wishCourse,this),this.$scope.$watch("course.ordersCount",e.bind(this._updateOrdersOptions,this))},orderCourse:function(r,s){n.isNotNull(r,"course"),n.isNotNull(s,"quantity"),this.$scope.state.isOrdering=!0,this.$scope.onOrderCourse({course:r,quantity:s}).finally(e.bind(function(){this.$scope.state.isOrdering=!1},this))},wishCourse:function(r){n.isNotNull(r,"course"),this.$scope.state.isWishing=!0,this.$scope.onWishCourse({course:r}).finally(e.bind(function(){this.$scope.state.isWishing=!1},this))},_updateOrdersOptions:function(){var e=this.$scope.course;this.$scope.orderOptions=this.userMenuService.getOrderOptionsForCourse(e),this.$scope.defaultOption=this.userMenuService.getDefaultOrderOptionForCourse(e)}})];return i}),define("user/menu/controllers/menu/userMenuViewController",["angular","underscore","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","userMenuService","menuService",s.create(function(r,s,n){this.$scope=t.extend(r,e.copy(this.$scope),!0),this.userMenuService=s,this.menuService=n,this.initialize()},{$scope:{date:null,courses:[],categoriesMenu:[]},userMenuService:null,menuService:null,initialize:function(){this.$scope.$watch("courses",r.bind(this._onCoursesUpdated,this))},_onCoursesUpdated:function(e){n.isNotNull(e,"courses"),n.isArray(e,"courses"),this.$scope.categoriesMenu=this.menuService.groupCoursesByCategories(e)}})];return i}),define("user/menu/controllers/orders/userOrdersController",["underscore","angular","framework/class","framework/assert","framework/utils","toastr"],function(e,r,s,n,t,i){var o=["$scope","$q","orderService","boxCapacityService",s.create(function(e,s,n,i){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.$q=s,this.orderService=n,this.boxCapacityService=i,this.initialize()},{$scope:{date:null,isFreezed:null,orders:[],orderedBoxes:{}},$q:null,orderService:null,boxCapacityService:null,initialize:function(){this.$scope.removeOrder=e.bind(this.removeOrder,this),this.$scope.moveOrderToBox=e.bind(this.moveOrderToBox,this),this.$scope.$watch("orders",e.bind(this._updateOrders,this),!0)},removeOrder:function(e){return n.isNotNull(e,"order"),this.$scope.onRemoveOrder({order:e})},moveOrderToBox:function(e,r){n.isNotNull(e,"order"),n.isNotNull(r,"box");var s=this._validateBoxCapacity(e,r);return s.isValid?this.$scope.onMoveOrderToBox({order:e,box:r}):(i.error(s.message),this.$q.rejectAsync(s.message))},_updateOrders:function(){this.$scope.orderedBoxes=this.orderService.groupOrdersByBoxes(this.$scope.orders)},_validateBoxCapacity:function(s,n){var t=e.find(this.$scope.orderedBoxes.boxes,function(e){return e.index===n}),i=t?r.copy(t.orders):[];i=this.orderService.addNewOrderToCollection(i,s);var o=this.boxCapacityService.checkBoxCapacity(i);return o}})];return o}),define("user/menu/controllers/orders/userOrderController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","orderService",s.create(function(e,s){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.orderService=s,this.initialize()},{$scope:{order:null,isFreezed:null,isBoxingAllowed:null,boxes:[],state:{inMovingToBox:!1,isRemoving:!1}},orderService:null,initialize:function(){this.$scope.isBoxingAllowed=this.orderService.checkCourseBoxingAllowed(this.$scope.order.course),this.$scope.removeOrder=e.bind(this.removeOrder,this),this.$scope.moveOrderToBox=e.bind(this.moveOrderToBox,this),this.$scope.moveOrderToNewBox=e.bind(this.moveOrderToNewBox,this)},removeOrder:function(r){n.isNotNull(r,"order"),this.$scope.state.isRemoving=!0,this.$scope.onRemoveOrder({order:r}).finally(e.bind(function(){this.$scope.state.isRemoving=!1},this))},moveOrderToBox:function(r,s){n.isNotNull(r,"order"),n.isNotNull(s,"box"),this.$scope.state.inMovingToBox=!0,this.$scope.onMoveOrderToBox({order:r,box:s}).finally(e.bind(function(){this.$scope.state.inMovingToBox=!1},this))},moveOrderToNewBox:function(e){n.isNotNull(e,"order");var r=this.orderService.getNewBoxIndex(this.$scope.boxes);this.moveOrderToBox(e,r)}})];return i}),define("user/menu/controllers/controllers",["angular","core/core","user/menu/controllers/userManageOrdersController","user/menu/controllers/anonymousUserMenuController","user/menu/controllers/menu/userMenuController","user/menu/controllers/menu/userMenuCourseController","user/menu/controllers/menu/userMenuViewController","user/menu/controllers/orders/userOrdersController","user/menu/controllers/orders/userOrderController"],function(e,r,s,n,t,i,o,u,a){var c=[r.name],l=e.module("lunchtime.user.menu.controllers",c);return l.controller("userManageOrdersController",s),l.controller("anonymousUserMenuController",n),l.controller("userMenuController",t),l.controller("userMenuCourseController",i),l.controller("userMenuViewController",o),l.controller("userOrdersController",u),l.controller("userOrderController",a),l}),define("user/menu/models/orderOption",["underscore","framework/assert"],function(e,r){var s=function(s,n){r.isNotNull(s,"quantity"),this.quantity=s,this.name=e.isUndefined(n)?s.toString():n};return s}),define("user/menu/services/userMenuService",["underscore","framework/assert","user/menu/models/orderOption"],function(e,r,s){var n=["categoryService",function(e){return{getDefaultOrderOptionForCourse:function(e){var r=e.maxOrders-e.ordersCount,n=.5===r?new s(.5,"1/2"):new s(1,"");
return n},getOrderOptionsForCourse:function(r){var n=[],t=r.maxOrders-r.ordersCount;if(0===t)return n;var i=e.isHalfPortionsAllowed(r.category);return i&&t>=.5&&n.push(new s(.5,"1/2")),t>=2&&n.push(new s(2,"2")),n}}}];return n}),define("user/menu/models/box",["framework/assert"],function(e){var r=function(r,s){e.isNotNull(r,"index"),e.isNotNull(s,"orders"),e.isArray(s,"orders"),this.index=r,this.orders=s,this.ordersSum=0};return r}),define("user/menu/models/orderedBoxes",["framework/assert"],function(e){var r=function(r){e.isNotNull(r,"boxes"),e.isArray(r,"boxes"),this.boxes=r,this.ordersSum=0};return r}),define("user/menu/services/orderService",["underscore","framework/assert","framework/utils","user/menu/models/box","user/menu/models/orderedBoxes"],function(e,r,s,n,t){var i=["user.config",function(s){return{groupOrdersByBoxes:function(s){r.isArray(s,"orders");var i=e.chain(s).groupBy(function(e){return e.box}).pairs().map(function(r){var s=parseInt(r[0],10),t=e.chain(r[1]).sortBy(function(e){return e.course.name}).sortBy(function(e){return e.course.category.id}).value();return new n(s,t)}).value();0===i.length&&i.push(new n(0,[]));var o=new t(i);return this.calculateOrdersSum(o),o},addNewOrderToCollection:function(s,n){r.isArray(s,"orders"),r.isNotNull(n,"newOrder");var t=e.find(s,function(e){return e.id===n.id});return t?t.quantity+=n.quantity:s.push(n),s},removeOrderFromCollection:function(s,n){return r.isArray(s,"orders"),r.isNotNull(n,"removedOrder"),e.without(s,n)},getNewBoxIndex:function(n){r.isArray(n,"boxes");for(var t=1,i=e.map(n,function(e){return e.index});t<s.restrictions.maxBoxCount;){var o=e.contains(i,t);if(!o)return t;t++}throw new Error("Вы не можете заказать больше {0} боксов.".format(s.restrictions.maxBoxCount))},calculateOrdersSum:function(s){r.isNotNull(s,"orderedBoxes");var n=0;e.each(s.boxes,function(r){var s=0;e.each(r.orders,function(e){var r=e.course.price*e.quantity;s+=r}),r.ordersSum=s,n+=s}),s.ordersSum=n},checkCourseBoxingAllowed:function(n){r.isNotNull(n,"course");var t=e.contains(s.restrictions.boxingAllowedCategories,n.category.id);return t}}}];return i}),define("common/models/order",["framework/assert"],function(e){var r=function(r,s,n,t){e.isNotNull(r,"id"),e.isNotNull(s,"course"),e.isNotNull(n,"quantity"),e.isNumber(n,"quantity"),e.isNotNull(t,"box"),e.isNumber(t,"box"),this.id=r,this.course=s,this.quantity=n,this.box=t};return r}),define("user/menu/services/userMenuApiService",["underscore","moment","framework/assert","framework/utils","common/models/order"],function(e,r,s,n,t){var i=["$http","$q","user.config","userMenuApiMappingService",function(e,n,i,o){var u=i.urls.api;return{getCoursesAndOrders:function(t){s.isNotNull(t,"date");var i=n.defer(),a={params:{date:r(t).format("YYYY-MM-DD")}};return e.get(u.getCoursesAndOrders,a).success(function(e){s.isNotNull(e,"response");var r=o.mapResponseToMenuData(e);i.resolve(r)}).error(function(e){i.reject(e)}),i.promise},getCourses:function(t){s.isNotNull(t,"date");var i=n.defer(),a={params:{date:r(t).format("YYYY-MM-DD")}};return e.get(u.getCourses,a).success(function(e){s.isNotNull(e,"response");var r=o.mapResponseToAnonymousMenuData(e);i.resolve(r)}).error(function(e){i.reject(e)}),i.promise},orderCourse:function(i,o,a){s.isNotNull(i,"course"),s.isNotNull(o,"quantity"),s.isNotNull(a,"date");var c={courseId:i.id,quantity:o,date:r(a).format("YYYY-MM-DD")},l=n.defer();return e.post(u.orderCourse,c).success(function(e){s.isNotNull(e,"orderId"),e=parseInt(e,10);var r=new t(e,i,o,0);l.resolve(r)}).error(function(e){l.reject(e)}),l.promise},removeOrder:function(t,i){s.isNotNull(t,"order"),s.isNotNull(i,"date");var o=n.defer(),a={orderId:t.id,date:r(i).format("YYYY-MM-DD")};return e.post(u.removeOrder,a).success(function(){o.resolve(t)}).error(function(e){o.reject(e)}),o.promise},moveOrderToBox:function(i,o,a){s.isNotNull(i,"order"),s.isNotNull(o,"box");var c=n.defer(),l={orderId:i.id,quantity:i.quantity,box:o,date:r(a).format("YYYY-MM-DD")};return e.post(u.moveOrderToBox,l).success(function(e){s.isNotNull(e,"orderId"),e=parseInt(e,10);var r=new t(e,i.course,i.quantity,o);c.resolve(r)}).error(function(e){c.reject(e)}),c.promise},wishCourse:function(t,i){s.isNotNull(t,"course"),s.isNotNull(i,"date");var o={menuItemId:t.menuItemId,date:r(i).format("YYYY-MM-DD")},a=n.defer();return e.post(u.wishCourse,o).success(function(){a.resolve()}).error(function(e){a.reject(e)}),a.promise},unwishCourse:function(t,i){s.isNotNull(t,"course"),s.isNotNull(i,"date");var o={menuItemId:t.menuItemId,date:r(i).format("YYYY-MM-DD")},a=n.defer();return e.post(u.unwishCourse,o).success(function(){a.resolve()}).error(function(e){a.reject(e)}),a.promise}}}];return i}),define("core/models/timeSpan",["underscore","framework/assert"],function(e,r){var s=function(s,n,t){r.isNumber(s),r.isTrue(s>=0&&24>s,"hours",'"{0}" value must be between 0 and 23.'),r.isNumber(n),r.isTrue(n>=0&&59>n,"minutes",'"{0}" value must be between 0 and 59.'),e.isUndefined(t)||(r.isNumber(t),r.isTrue(t>=0&&59>t,"seconds",'"{0}" value must be between 0 and 59.')),this.hours=s,this.minutes=n,this.seconds=t||0};return s}),define("user/menu/models/menuData",["framework/assert"],function(){var e=function(e,r,s,n,t,i){this.date=e,this.isFreezed=r,this.freezeTime=s,this.courses=n,this.orders=t,this.wishedCourses=i||null};return e}),define("user/menu/services/userMenuApiMappingService",["underscore","moment","framework/assert","framework/utils","core/models/timeSpan","common/models/order","user/menu/models/menuData"],function(e,r,s,n,t,i,o){var u=["commonApiMappingService",function(n){return{mapResponseToMenuData:function(u){s.isNotNull(u.Date,"response.Date"),s.isArray(u.AvailableCourses,"response.AvailableCourses"),s.isArray(u.OrderedMenus,"response.OrderedMenus");var a={},c=e.map(u.AvailableCourses,function(e){var r=n.mapResponseToCourse(e);return a[r.id]=r,r},this),l=e.map(u.OrderedMenus,function(e){var r=a[e.Course.ID];s.isNotNull(r,"course");var n=new i(e.Course.OrderItemID,r,e.Quantity,e.Course.Boxindex);return n}),d=r(u.Date).toDate(),m=u.IsFreezed,p=r(u.FreezeTime,"hh:mm:ss"),h=new t(p.hour(),p.minute()),f=e.map(u.WishedCourses,function(e){return a[e]}),v=new o(d,m,h,c,l,f);return v}}}];return u}),define("user/menu/models/boxCapacityValidationResult",[],function(){var e=function(e,r){this.isValid=e,this.message=r};return e}),define("user/menu/services/boxCapacityService",["underscore","framework/assert","common/models/categories","user/menu/models/boxCapacityValidationResult"],function(e,r,s,n){var t=[function(){return{checkBoxCapacity:function(e){return r.isNotNull(e,"orders"),new n(!0)},_checkSalads:function(r){var t=e.any(r,function(e){return e.course.category.id===s.salad});return t?new n(!1,"Салаты уже упакованы в боксы."):new n(!0)},_checkOthers:function(r){var t=e.any(r,function(e){return e.course.category.id===s.other});return t?new n(!1,'Блюда из категории "Другое" нельзя помещать в боксы.'):new n(!0)},_checkSoups:function(r){var t=e.filter(r,function(e){return e.course.category.id===s.soup});if(0===t.length)return new n(!0);if(t.length!==r.length)return new n(!1,"Суп должен находиться в отдельном боксе");if(t.length>1)return new n(!1,"Нельзя смешивать два разных супа в одном боксе.");var i=t[0];return i.quantity>1?new n(!1,"Нельзя поместить больше одной порции супа в бокс."):new n(!0)},_checkMeatAndGarnish:function(r){var s=0;return e.each(r,function(e){s+=e.quantity}),s>2?new n(!1,"Нельзя поместить больше двух порций в один конейнер."):new n(!0)}}}];return t}),define("user/menu/services/services",["angular","angular-resource","core/core","common/common","user/menu/services/userMenuService","user/menu/services/orderService","user/menu/services/userMenuApiService","user/menu/services/userMenuApiMappingService","user/menu/services/boxCapacityService"],function(e,r,s,n,t,i,o,u,a){var c=["ngResource",s.name,n.name],l=e.module("lunchtime.user.menu.services",c);return l.service("userMenuService",t),l.service("orderService",i),l.service("userMenuApiService",o),l.service("userMenuApiMappingService",u),l.service("boxCapacityService",a),l}),define("user/menu/filters/boxTitleFilter",["framework/assert"],function(){var e=[function(){return function(e){return e?0===e.index?"Заказ":"Бокс #{0}".format(e.index):""}}];return e}),define("user/menu/filters/filters",["angular","user/menu/filters/boxTitleFilter"],function(e,r){var s=[],n=e.module("lunchtime.user.menu.filters",s);return n.filter("boxTitleFilter",r),n}),define("user/menu/directives/menu/userMenu",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/user/menu/menu.tmpl",scope:{courses:"=",wishedCourses:"=",date:"=",isFreezed:"=",onOrderCourse:"&"},controller:"userMenuController"}}];return e}),define("user/menu/directives/menu/userMenuCourse",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/user/menu/menu/course.tmpl",scope:{course:"=",isFreezed:"=",isWished:"=",onOrderCourse:"&",onWishCourse:"&"},controller:"userMenuCourseController"}}];return e}),define("user/menu/directives/menu/userMenuView",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/user/menu/view.tmpl",scope:{courses:"=",date:"="},controller:"userMenuViewController"}}];return e}),define("user/menu/directives/orders/userOrders",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/user/menu/orders.tmpl",scope:{orders:"=",date:"=",isFreezed:"=",onRemoveOrder:"&",onMoveOrderToBox:"&"},controller:"userOrdersController"}}];return e}),define("user/menu/directives/orders/userOrder",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/user/menu/orders/order.tmpl",scope:{order:"=",isFreezed:"=",boxes:"=",onRemoveOrder:"&",onMoveOrderToBox:"&"},controller:"userOrderController"}}];return e}),define("user/menu/directives/directives",["angular","user/menu/directives/menu/userMenu","user/menu/directives/menu/userMenuCourse","user/menu/directives/menu/userMenuView","user/menu/directives/orders/userOrders","user/menu/directives/orders/userOrder"],function(e,r,s,n,t,i){var o=[],u=e.module("lunchtime.user.menu.directives",o);return u.directive("ltUserMenu",r),u.directive("ltUserMenuCourse",s),u.directive("ltUserMenuView",n),u.directive("ltUserOrders",t),u.directive("ltUserOrder",i),u}),define("user/menu/providers/providers",["angular"],function(e){var r=[],s=e.module("lunchtime.user.menu.providers",r);return s}),define("user/menu/templates/templates",["angular"],function(e){var r=[],s=e.module("lunchtime.user.menu.templates",r);return s.run(["$templateCache",function(){}]),s}),define("user/menu/menu",["angular","core/core","common/common","user/menu/controllers/controllers","user/menu/services/services","user/menu/filters/filters","user/menu/directives/directives","user/menu/providers/providers","user/menu/templates/templates"],function(e,r,s,n,t,i,o,u,a){var c=[r.name,s.name,n.name,t.name,i.name,o.name,u.name,a.name],l=e.module("lunchtime.user.menu",c);return l}),define("user/user",["angular","common/common","user/user.config","user/user.routes","user/menu/menu"],function(e,r,s,n,t){var i=[r.name,t.name],o=e.module("lunchtime.user",i);return o.constant("user.config",s),o.config(n),o}),define("admin/admin.config",["application.config"],function(e){var r="/Admin/Index",s=e.urls.api.baseUrl+"/Admin",n=e.urls.api.baseUrl+"/Orders";return{urls:{application:r,sales:"/Orders/Sales",api:{menu:{getMenuAndCourses:s+"/GetMenuAndCourses",removeCourseFromMenu:s+"/RemoveCourseFromMenu",createCourse:s+"/CreateCourse",updateCourse:s+"/UpdateCourse",removeCourse:s+"/RemoveCourse",changeCourseMaxOrders:s+"/ChangeMaxOrders",addCourseToMenu:s+"/AddCourseToMenu",tempCoursePicture:e.urls.api.baseUrl+"/coursepicture/image?tempname={0}",coursePicture:e.urls.api.coursePicture,courseThumbnail:e.urls.api.courseThumbnail,uploadCoursePicture:e.urls.api.baseUrl+"/coursepicture/image?companyid="+e.defaultCompanyId+"&courseid={0}"},sales:{getUsersOrders:n+"/GetUsersOrders",purchaseOrder:n+"/PurchaseOrder",undoPurchaseOrder:n+"/UndoPurchaseOrder",removeOrder:n+"/RemoveOrder"}},views:{menuView:"/template/admin/menu.tmpl",salesView:"/template/admin/sales.tmpl"}}}}),define("admin/admin.routes",[],function(){var e=["$routeProvider","$locationProvider","admin.config",function(e,r,s){var n=s.urls.application,t=s.urls.views;e.when(n+"/:date?",{templateUrl:t.menuView,controller:"adminManageMenuController",resolve:{menuData:["adminMenuApiService","$route",function(e,r){var s=r.current.params.date;if(!s){var n=new Date,t=n.getDay()>=5?8-n.getDay():1;s=n.setDate(n.getDate()+t)}var i=e.getMenuAndCourses(s);return i}]}}),e.when(s.urls.sales,{templateUrl:t.salesView,controller:"adminSalesController",resolve:{salesData:["adminSalesApiService",function(e){var r=new Date(2015,0,1),s=e.getUsersOrders(r);return s}]}})}];return e}),define("admin/admin.events",[],function(){var e={sales:{cardReader:{input:"lunch-time.admin.events.sales.card-reader.input"}}};return e}),define("admin/menu/controllers/adminManageMenuController",["underscore","angular","framework/class","framework/assert","framework/utils","toastr"],function(e,r,s,n,t){var i=["$scope","$q","$modal","config","adminMenuApiService","menuData",s.create(function(e,s,n,i,o,u){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.$q=s,this.$modal=n,this.config=i,this.adminMenuApiService=o,this.initialize(u)},{$scope:{date:null,menuCourses:[],availableCourses:[]},$q:null,$modal:null,config:null,adminMenuApiService:null,initialize:function(r){n.isNotNull(r,"menuData"),this.$scope.date=r.date,this.$scope.menuCourses=r.menuCourses,this.$scope.availableCourses=r.availableCourses,this.$scope.addCourseToMenu=e.bind(this.addCourseToMenu,this)},addCourseToMenu:function(r){n.isNotNull(r,"course");var s=function(r){var s=e.find(this.$scope.menuCourses,function(e){return e.id===r.id});if(s){var n=e.indexOf(this.$scope.menuCourses,s);this.$scope.menuCourses[n]=r}else this.$scope.menuCourses.push(r)},t=e.bind(function(n){var t=this.adminMenuApiService.addCourseToMenu(r,n,this.$scope.date);return t.then(e.bind(s,this)),t},this),i=e.extend({},this.config.dialogOptions,{templateUrl:"/template/admin/menu/add-course-to-menu.tmpl",controller:"adminMenuCourseChangeMaxOrdersController",resolve:{course:function(){return r},onSaveChanges:function(){return t}}});this.$modal.open(i)}})];return i}),define("admin/menu/controllers/adminAddCourseToMenuController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","$modalInstance","adminMenuApiService","course","date",s.create(function(e,s,n,i,o){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.$modalInstance=s,this.adminMenuApiService=n,this.initialize(i,o)},{$scope:{course:null,state:{isSavingChanges:null}},$modalInstance:null,adminMenuApiService:null,course:null,date:null,initialize:function(s,t){n.isNotNull(s,"course"),n.isNotNull(t,"date"),this.course=s,this.date=t,this.$scope.course=r.copy(s),this.$scope.state={isSavingChanges:null},this.$scope.addCourseToMenu=e.bind(this.addCourseToMenu,this),this.$scope.closeDialog=e.bind(this.closeDialog,this)},addCourseToMenu:function(){n.isNumber(this.$scope.course.maxOrders,"maxOrders"),n.isTrue(this.$scope.course.maxOrders>0,"maxOrders");var r=this.$scope.course.maxOrders;this.$scope.state.isSavingChanges=!0,this.adminMenuApiService.addCourseToMenu(this.course,r,this.date).then(e.bind(function(e){this.$modalInstance.close(e)},this)).finally(e.bind(function(){this.$scope.state.isSavingChanges=!1},this))},closeDialog:function(){this.$modalInstance.dismiss()}})];return i}),define("admin/menu/controllers/menu/adminMenuController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","$modal","config","menuService","adminMenuApiService",s.create(function(e,s,n,i,o){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.$modal=s,this.config=n,this.menuService=i,this.adminMenuApiService=o,this.initialize()},{$scope:{course:null,date:null,categoriesMenu:null},$modal:null,config:null,menuService:null,adminMenuApiService:null,initialize:function(){this.$scope.removeCourse=e.bind(this.removeCourse,this),this.$scope.changeCourseMaxOrders=e.bind(this.changeCourseMaxOrders,this),this.$scope.$watchCollection("courses",e.bind(this._onCoursesUpdated,this))},removeCourse:function(r){n.isNotNull(r,"course");var s=function(){return this.adminMenuApiService.removeCourseFromMenu(r,this.$scope.date)},i=function(){return t.array.without(this.$scope.courses,r),r};return this._confirmRemoveCourse(r).then(e.bind(s,this)).then(e.bind(i,this))},changeCourseMaxOrders:function(r){n.isNotNull(r,"course");var s=e.bind(function(e){return this.adminMenuApiService.changeCourseMaxOrders(r,e,this.$scope.date)},this),t=e.extend({},this.config.dialogOptions,{templateUrl:"/template/admin/menu/menu/course/change-max-orders.tmpl",controller:"adminMenuCourseChangeMaxOrdersController",resolve:{course:function(){return r},onSaveChanges:function(){return s}}});this.$modal.open(t)},_onCoursesUpdated:function(e){n.isNotNull(e,"courses"),this.$scope.categoriesMenu=this.menuService.groupCoursesByCategories(e)},_confirmRemoveCourse:function(r){n.isNotNull(r,"course");var s=e.extend({},this.config.dialogOptions,{templateUrl:"/template/admin/menu/menu/course/confirm-remove.tmpl",resolve:{data:function(){return{course:r}}},controller:"confirmController"}),t=this.$modal.open(s);return t.result}})];return i}),define("admin/menu/controllers/menu/adminMenuCourseController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","admin.config",s.create(function(e,s){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.adminConfig=s,this.initialize()},{$scope:{course:null,date:null,courseImage:{url:null,thumbnailUrl:null},state:{isRemoving:!1}},adminConfig:null,initialize:function(){this.$scope.courseImage.url=this.adminConfig.urls.api.menu.coursePicture.format(this.$scope.course.id),this.$scope.courseImage.thumbnailUrl=this.adminConfig.urls.api.menu.courseThumbnail.format(this.$scope.course.id),this.$scope.removeCourse=e.bind(this.removeCourse,this),this.$scope.changeMaxOrders=e.bind(this.changeMaxOrders,this)},removeCourse:function(r){n.isNotNull(r,"course"),this.$scope.state.isRemoving=!0,this.$scope.onRemoveCourse({course:r}).finally(e.bind(function(){this.$scope.state.isRemoving=!1},this))},changeMaxOrders:function(e){n.isNotNull(e,"course"),this.$scope.onChangeCourseMaxOrders({course:e})}})];return i}),define("admin/menu/controllers/menu/adminMenuCourseChangeMaxOrdersController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","$modalInstance","course","onSaveChanges",s.create(function(e,s,n,i){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.$modalInstance=s,this.initialize(n,i)},{$scope:{course:null,state:{isSavingChanges:null}},$modalInstance:null,course:null,onSaveChanges:null,initialize:function(s,t){n.isNotNull(s,"course"),n.isNotNull(t,"onSaveChanges"),this.course=s,this.onSaveChanges=t,this.$scope.course=r.copy(s),this.$scope.state={isSavingChanges:null},this.$scope.saveChanges=e.bind(this.saveChanges,this),this.$scope.closeDialog=e.bind(this.closeDialog,this)},saveChanges:function(){n.isNumber(this.$scope.course.maxOrders,"maxOrders"),n.isTrue(this.$scope.course.maxOrders>0,"maxOrders");var r=this.$scope.course.maxOrders;this.$scope.state.isSavingChanges=!0,this.onSaveChanges(r).then(e.bind(function(){this.$modalInstance.close()},this)).finally(e.bind(function(){this.$scope.state.isSavingChanges=!1},this))},closeDialog:function(){this.$modalInstance.dismiss()}})];return i}),define("admin/menu/controllers/courses/adminCoursesController",["underscore","angular","framework/class","framework/assert","framework/utils","common/models/course"],function(e,r,s,n,t,i){var o=["$scope","$modal","menuService","adminMenuApiService","config",s.create(function(e,s,n,i,o){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.$modal=s,this.menuService=n,this.adminMenuApiService=i,this.config=o,this.initialize()},{$scope:{courses:null,categoriesCourses:null},$modal:null,menuService:null,adminMenuApiService:null,config:null,initialize:function(){this.$scope.$watchCollection("courses",e.bind(this._onCoursesUpdated,this)),this.$scope.addCourseToMenu=e.bind(this.addCourseToMenu,this),this.$scope.createCourse=e.bind(this.createCourse,this),this.$scope.editCourse=e.bind(this.editCourse,this),this.$scope.removeCourse=e.bind(this.removeCourse,this)},addCourseToMenu:function(e){n.isNotNull(e,"course"),this.$scope.onAddCourseToMenu({course:e})},createCourse:function(r){n.isNotNull(r,"category");var s=function(e){n.isNotNull(e,"course"),this.$scope.courses.push(e)},t=e.bind(function(r,t){n.isNotNull(r,"course");var i=this.adminMenuApiService.createCourse(r,t);return i.then(e.bind(s,this)),i},this),o=e.extend({},this.config.dialogOptions,{templateUrl:"/template/admin/menu/courses/course/create.tmpl",controller:"adminCourseEditController",windowClass:"modal-wide",resolve:{course:function(){return new i(0,"",0,r,0,0,0)},onSaveChange:function(){return t},dialogOptions:function(){return{title:"Создание нового блюда"}}}});this.$modal.open(o)},editCourse:function(s){n.isNotNull(s,"course");var t=function(r){n.isNotNull(r,"updatedCourse");var t=e.indexOf(this.$scope.courses,s);this.$scope.courses[t]=r},i=e.bind(function(r,s){n.isNotNull(r,"changedCourse");var i=this.adminMenuApiService.updateCourse(r,s);return i.then(e.bind(t,this)),i},this),o=e.extend({},this.config.dialogOptions,{templateUrl:"/template/admin/menu/courses/course/edit.tmpl",controller:"adminCourseEditController",windowClass:"modal-wide",resolve:{course:function(){return r.copy(s)},onSaveChange:function(){return i},dialogOptions:function(){return{title:"Редактирование блюда"}}}});this.$modal.open(o)},removeCourse:function(r){n.isNotNull(r,"course");var s=function(){t.array.without(this.$scope.courses,r)},i=this.adminMenuApiService.removeCourse(r);return i.then(e.bind(s,this)),i},_onCoursesUpdated:function(e){e&&(this.$scope.categoriesCourses?this.menuService.updateCategoriesMenus(this.$scope.categoriesCourses,e):this.$scope.categoriesCourses=this.menuService.groupCoursesByCategories(e))}})];return o}),define("admin/menu/controllers/courses/adminCoursesCategoryController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","config",s.create(function(e,s){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.config=s,this.initialize()},{$scope:{category:null,courses:null},config:null,initialize:function(){this.$scope.addCourseToMenu=e.bind(this.addCourseToMenu,this),this.$scope.editCourse=e.bind(this.editCourse,this),this.$scope.removeCourse=e.bind(this.removeCourse,this),this.$scope.createCourse=e.bind(this.createCourse,this)},addCourseToMenu:function(e){n.isNotNull(e,"course"),this.$scope.onAddCourseToMenu({course:e})},editCourse:function(e){this.$scope.onEditCourse({course:e})},createCourse:function(){var e=this.$scope.category;this.$scope.onCreateCourse({category:e})},removeCourse:function(e){return this.$scope.onRemoveCourse({course:e})}})];return i}),define("admin/menu/controllers/courses/adminCourseController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","$modal","$templateCache","$q","config",s.create(function(e,s,n,i,o){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.$modal=s,this.$templateCache=n,this.$q=i,this.config=o,this.initialize()},{$scope:{course:null,state:{isRemoving:!1}},$modal:null,$templateCache:null,$q:null,config:null,initialize:function(){this.$scope.addCourseToMenu=e.bind(this.addCourseToMenu,this),this.$scope.editCourse=e.bind(this.editCourse,this),this.$scope.removeCourse=e.bind(this.removeCourse,this)},addCourseToMenu:function(e){n.isNotNull(e,"course"),this.$scope.onAddCourseToMenu({course:e})},removeCourse:function(r){n.isNotNull(r,"course");var s=function(){this.$scope.state.isRemoving=!0;var s=this.$scope.onRemoveCourse({course:r});s.finally(e.bind(function(){this.$scope.state.isRemoving=!1},this))},t=e.extend({},this.config.dialogOptions,{templateUrl:"/template/admin/menu/courses/course/confirm-remove.tmpl",resolve:{data:function(){return{course:r}}},controller:"confirmController"}),i=this.$modal.open(t);i.result.then(e.bind(s,this))},editCourse:function(e){n.isNotNull(e,"course"),this.$scope.onEditCourse({course:e})}})];return i}),define("admin/menu/controllers/courses/adminCourseEditController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","$modalInstance","admin.config","adminMenuApiService","course","onSaveChange","dialogOptions",s.create(function(e,s,n,i,o,u,a){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.$modalInstance=s,this.adminConfig=n,this.adminMenuApiService=i,this.initialize(o,u,a)},{$scope:{course:null,courseImage:{url:null,tempId:null},uploadImageUrl:null,dialog:{title:""},state:{isSavingChanges:!1,isUpdatingImage:!1}},adminConfig:null,adminMenuApiService:null,initialize:function(r,s,t){n.isNotNull(r,"course"),n.isFunction(s,"onSaveChanges"),e.extend(this.$scope.dialog,t),this._onSaveChange=s,this.$scope.course=r,this.$scope.uploadImageUrl=this.adminConfig.urls.api.menu.uploadCoursePicture.format(r.id),this.$scope.saveChanges=e.bind(this.saveChanges,this),this.$scope.closeDialog=e.bind(this.closeDialog,this),this.$scope.imageUploading=e.bind(this.imageUploading,this),this.$scope.imageUploaded=e.bind(this.imageUploaded,this),this.$scope.imageUploadFailed=e.bind(this.imageUploadFailed,this),this.$scope.$watch("courseImage.tempId",e.bind(this._onCourseImageChanged,this))},saveChanges:function(){this.$scope.state.isSavingChanges=!0;var r=this.$scope.course,s=this.$scope.courseImage.tempId,n=this._onSaveChange(r,s);n.then(e.bind(function(){this.$modalInstance.close()},this)),n.finally(e.bind(function(){this.$scope.state.isSavingChanges=!1},this))},_onSaveChange:null,_onCourseImageChanged:function(e){var r;r=e?this.adminConfig.urls.api.menu.tempCoursePicture.format(e):this.adminConfig.urls.api.menu.coursePicture.format(this.$scope.course.id),this.$scope.courseImage.url=r},imageUploading:function(){this.$scope.state.isUpdatingImage=!0},imageUploadFailed:function(){this.$scope.state.isUpdatingImage=!1},imageUploaded:function(e,r){this.$scope.state.isUpdatingImage=!1;var s=JSON.parse(r.response);s&&s.length>0&&(this.$scope.courseImage.tempId=s[0])},closeDialog:function(){this.$modalInstance.dismiss()}})];return i}),define("admin/menu/controllers/controllers",["angular","admin/menu/controllers/adminManageMenuController","admin/menu/controllers/adminAddCourseToMenuController","admin/menu/controllers/menu/adminMenuController","admin/menu/controllers/menu/adminMenuCourseController","admin/menu/controllers/menu/adminMenuCourseChangeMaxOrdersController","admin/menu/controllers/courses/adminCoursesController","admin/menu/controllers/courses/adminCoursesCategoryController","admin/menu/controllers/courses/adminCourseController","admin/menu/controllers/courses/adminCourseEditController"],function(e,r,s,n,t,i,o,u,a,c){var l=[],d=e.module("lunchtime.admin.menu.controllers",l);return d.controller("adminManageMenuController",r),d.controller("adminAddCourseToMenuController",s),d.controller("adminMenuController",n),d.controller("adminMenuCourseController",t),d.controller("adminMenuCourseChangeMaxOrdersController",i),d.controller("adminCoursesController",o),d.controller("adminCoursesCategoryController",u),d.controller("adminCourseController",a),d.controller("adminCourseEditController",c),d}),define("admin/menu/services/adminMenuApiService",["underscore","angular","moment","framework/assert","framework/utils"],function(e,r,s,n){var t=["$http","$q","admin.config","adminMenuApiMappingService","commonApiMappingService",function(e,t,i,o,u){var a=i.urls.api.menu;return{getMenuAndCourses:function(r){n.isNotNull(r,"date");var i=t.defer(),u={params:{date:s(r).format("YYYY-MM-DD")}};return e.get(a.getMenuAndCourses,u).success(function(e){n.isNotNull(e,"reponse");var r=o.mapResponseToMenuData(e);i.resolve(r)}).error(function(e){i.reject(e)}),i.promise},createCourse:function(r,s){n.isNotNull(r,"course");var i=t.defer(),o={CompanyId:null,Name:r.name,Category:r.category.name,Price:r.price,Description:r.description,Weight:r.weight,ImageId:s||""};return e.post(a.createCourse,o).success(function(e){n.isNotNull(e,"reponse");var r=u.mapResponseToCourse(e);i.resolve(r)}).error(function(e){i.reject(e)}),i.promise},removeCourse:function(r){n.isNotNull(r,"course");var s=t.defer(),i={CourseId:r.id};return e.post(a.removeCourse,i).success(function(){s.resolve(r)}).error(function(e){s.reject(e)}),s.promise},updateCourse:function(r,s){n.isNotNull(r,"course");var i=t.defer(),o={Id:r.id,CompanyId:null,Name:r.name,Category:r.category.name,Price:r.price,Description:r.description,Weight:r.weight,ImageId:s||""};return e.post(a.updateCourse,o).success(function(e){n.isNotNull(e,"reponse");var r=u.mapResponseToCourse(e);i.resolve(r)}).error(function(e){i.reject(e)}),i.promise},removeCourseFromMenu:function(r,i){n.isNotNull(r,"course"),n.isNotNull(i,"date");var o=t.defer(),u={CourseId:r.id,Date:s(i).format("YYYY-MM-DD")};return e.post(a.removeCourseFromMenu,u).success(function(){o.resolve(r)}).error(function(e){o.reject(e)}),o.promise},changeCourseMaxOrders:function(r,i,o){n.isNotNull(r,"course"),n.isNotNull(i,"maxOrders"),n.isNotNull(o,"date");var u=t.defer(),c={CourseId:r.id,MaxOrders:i,Date:s(o).format("YYYY-MM-DD")};return e.post(a.changeCourseMaxOrders,c).success(function(){r.maxOrders=i,u.resolve(r)}).error(function(e){u.reject(e)}),u.promise},addCourseToMenu:function(i,o,u){n.isNotNull(i,"course"),n.isNotNull(o,"maxOrders"),n.isNotNull(u,"date");var c=t.defer(),l={CourseId:i.id,MaxOrders:o,Date:s(u).format("YYYY-MM-DD")};return e.post(a.addCourseToMenu,l).success(function(){var e=r.copy(i);e.maxOrders=o,c.resolve(e)}).error(function(e){c.reject(e)}),c.promise}}}];return t}),define("admin/menu/models/menuData",["framework/assert"],function(e){var r=function(r,s,n){e.isNotNull(r,"date"),e.isArray(s,"menuCourses"),e.isArray(n,"availableCourses"),this.date=r,this.menuCourses=s,this.availableCourses=n};return r}),define("admin/menu/services/adminMenuApiMappingService",["underscore","moment","framework/assert","framework/utils","admin/menu/models/menuData"],function(e,r,s,n,t){var i=["commonApiMappingService",function(n){return{mapResponseToMenuData:function(i){s.isNotNull(i.Date,"response.Date"),s.isArray(i.AvailableCourses,"response.AvailableCourses"),s.isArray(i.MenuCourses,"response.MenuCourses");var o=r(i.Date).toDate(),u=e.map(i.AvailableCourses,n.mapResponseToCourse,this),a=e.map(i.MenuCourses,n.mapResponseToCourse,this),c=new t(o,a,u);return c}}}];return i}),define("admin/menu/services/services",["angular","admin/menu/services/adminMenuApiService","admin/menu/services/adminMenuApiMappingService"],function(e,r,s){var n=[],t=e.module("lunchtime.admin.menu.services",n);return t.service("adminMenuApiService",r),t.service("adminMenuApiMappingService",s),t}),define("admin/menu/filters/filters",["angular"],function(e){var r=[],s=e.module("lunchtime.admin.menu.filters",r);return s}),define("admin/menu/directives/menu/adminMenu",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/admin/menu/menu.tmpl",scope:{courses:"=",date:"="},controller:"adminMenuController"}}];return e}),define("admin/menu/directives/menu/adminMenuCourse",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/admin/menu/menu/course.tmpl",scope:{course:"=",onRemoveCourse:"&",onChangeCourseMaxOrders:"&"},controller:"adminMenuCourseController"}}];return e}),define("admin/menu/directives/courses/adminCourses",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/admin/menu/courses.tmpl",scope:{courses:"=",onAddCourseToMenu:"&"},controller:"adminCoursesController"}
}];return e}),define("admin/menu/directives/courses/adminCoursesCategory",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/admin/menu/courses/category.tmpl",scope:{category:"=",courses:"=",onAddCourseToMenu:"&",onCreateCourse:"&",onRemoveCourse:"&",onEditCourse:"&"},controller:"adminCoursesCategoryController"}}];return e}),define("admin/menu/directives/courses/adminCourse",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/admin/menu/courses/course.tmpl",scope:{course:"=",onAddCourseToMenu:"&",onRemoveCourse:"&",onEditCourse:"&"},controller:"adminCourseController"}}];return e}),define("admin/menu/directives/directives",["angular","admin/menu/directives/menu/adminMenu","admin/menu/directives/menu/adminMenuCourse","admin/menu/directives/courses/adminCourses","admin/menu/directives/courses/adminCoursesCategory","admin/menu/directives/courses/adminCourse"],function(e,r,s,n,t,i){var o=[],u=e.module("lunchtime.admin.menu.directives",o);return u.directive("ltAdminMenu",r),u.directive("ltAdminMenuCourse",s),u.directive("ltAdminCourses",n),u.directive("ltAdminCoursesCategory",t),u.directive("ltAdminCourse",i),u}),define("admin/menu/providers/providers",["angular"],function(e){var r=[],s=e.module("lunchtime.admin.menu.providers",r);return s}),define("admin/menu/templates/templates",["angular"],function(e){var r=[],s=e.module("lunchtime.admin.menu.templates",r);return s.run(["$templateCache",function(){}]),s}),define("admin/menu/menu",["angular","admin/menu/controllers/controllers","admin/menu/services/services","admin/menu/filters/filters","admin/menu/directives/directives","admin/menu/providers/providers","admin/menu/templates/templates"],function(e,r,s,n,t,i,o){var u=[r.name,s.name,n.name,t.name,i.name,o.name],a=e.module("lunchtime.admin.menu",u);return a}),define("admin/sales/controllers/adminSalesController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","$q","$modal","adminSalesService","adminSalesApiService","adminSalesDateWatcherService","salesData",s.create(function(e,s,n,i,o,u,a){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.$q=s,this.$modal=n,this.adminSalesService=i,this.adminSalesApiService=o,this.adminSalesDateWatcherService=u,this.initialize(a)},{$scope:{date:null,usersOrders:[],orderedCoursesStats:[]},$q:null,$modal:null,adminSalesService:null,adminSalesApiService:null,adminSalesDateWatcherService:null,initialize:function(r){n.isNotNull(r,"salesData"),n.isNotNull(r.date,"salesData.date"),n.isArray(r.usersOrders,"salesData.usersOrders"),this.$scope.date=r.date,this.$scope.usersOrders=r.usersOrders,this.$scope.purchaseOrder=e.bind(this.purchaseOrder,this),this.$scope.undoPurchaseOrder=e.bind(this.undoPurchaseOrder,this),this.$scope.removeOrder=e.bind(this.removeOrder,this),this.$scope.$watch("usersOrders",e.bind(this.onOrdersChanged,this),!0),this.$scope.$on("$destroy",e.bind(this.onDestroy,this)),this.adminSalesDateWatcherService.watch()},onOrdersChanged:function(e){this.$scope.orderedCoursesStats=this.adminSalesService.getOrderedCoursesStats(e)},purchaseOrder:function(e){n.isNotNull(e,"userOrder");var r=this.adminSalesApiService.purchaseOrder(e,this.$scope.date);return r},undoPurchaseOrder:function(e){n.isNotNull(e,"userOrder");var r=this.adminSalesApiService.undoPurchaseOrder(e,this.$scope.date);return r},removeOrder:function(e){n.isNotNull(e,"userOrder");var r=this.adminSalesApiService.removeOrder(e,this.$scope.date);return r},onDestroy:function(){this.adminSalesDateWatcherService.dispose()}})];return i}),define("admin/sales/controllers/adminSalesCoursesStatsController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope",s.create(function(e){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.initialize()},{$scope:{date:null,coursesStats:[]},initialize:function(){}})];return i}),define("admin/sales/models/activeUserOrder",[],function(){var e=function(e,r){this.userOrder=e,this.isActivatedByIdentityCard=r};return e}),define("admin/sales/controllers/adminSalesUsersOrdersController",["underscore","angular","framework/class","framework/assert","framework/utils","admin/sales/models/activeUserOrder"],function(e,r,s,n,t,i){var o={userOrder:"user-order",usersOrders:"users-orders"},u=["$scope","$modal","config","adminSalesService","adminSalesCardReaderService",s.create(function(e,s,n,i,o){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.$modal=s,this.config=n,this.adminSalesService=i,this.adminSalesCardReaderService=o,this.initialize()},{$scope:{date:null,salesStats:null,usersOrders:[],purchasedUsersOrders:[],notPurchasedUsersOrders:[],activeUserOrder:null,viewState:o.usersOrders},$modal:null,config:null,adminSalesService:null,adminSalesCardReaderService:null,activeModal:null,initialize:function(){this.$scope.viewUserOrder=e.bind(this.viewUserOrder,this),this.$scope.purchaseOrder=e.bind(this.purchaseOrder,this),this.$scope.undoPurchaseOrder=e.bind(this.undoPurchaseOrder,this),this.$scope.closeActiveUserOrder=e.bind(this.closeActiveUserOrder,this),this.$scope.$watch("usersOrders",e.bind(this.onOrdersChanged,this),!0),this.$scope.$watch("activeUserOrder",e.bind(this.onActiveUserOrderChanged,this)),this.adminSalesCardReaderService.onInput(e.bind(this.onCardReaderInput,this))},onOrdersChanged:function(e){this.$scope.salesStats=this.adminSalesService.getSalesStats(e),this.$scope.purchasedUsersOrders=this.adminSalesService.getPurchasedUsersOrders(e),this.$scope.notPurchasedUsersOrders=this.adminSalesService.getNotPurchasedUsersOrders(e)},onActiveUserOrderChanged:function(e){this.$scope.viewState=e?o.userOrder:o.usersOrders},purchaseOrder:function(e){return n.isNotNull(e,"userOrder"),this.$scope.onPurchaseOrder({userOrder:e})},undoPurchaseOrder:function(e){return n.isNotNull(e,"userOrder"),this.$scope.onUndoPurchaseOrder({userOrder:e})},closeActiveUserOrder:function(){this.$scope.activeUserOrder=null},onCardReaderInput:function(r,s){n.isNotNull(s,"input");var t=this.adminSalesService.convertToIdentityNumber(s),o=this.adminSalesService.getUserOrderByIdentityNumber(this.$scope.usersOrders,t);if(o)if(o.orders.length>0){var u=function(){this.$scope.activeUserOrder=new i(o,!0)};o.isPurchased?this.$scope.activeUserOrder=new i(o,!0):this.$scope.onPurchaseOrder({userOrder:o}).then(e.bind(u,this))}else this.viewUserOrderNotFound(o.user);else this.viewUnknownUserIdentityNumber(s)},viewUserOrder:function(e){n.isNotNull(e,"userOrder"),this.$scope.activeUserOrder=new i(e,!1)},viewUserOrderNotFound:function(r){n.isNotNull(r,"user");var s=e.extend({},this.config.dialogOptions,{templateUrl:"/template/admin/sales/user-order/not-found.tmpl",controller:"confirmController",resolve:{data:function(){return{user:r}}}});this.dismissActiveModal(),this.activeModal=this.$modal.open(s)},viewUnknownUserIdentityNumber:function(r){n.isNotNull(r,"identityNumber");var s=e.extend({},this.config.dialogOptions,{templateUrl:"/template/admin/sales/unknown-identity-number.tmpl",controller:"confirmController",resolve:{data:function(){return{identityNumber:r}}}});this.dismissActiveModal(),this.activeModal=this.$modal.open(s)},dismissActiveModal:function(){if(this.activeModal)try{this.activeModal.dismiss()}catch(e){}finally{this.activeModal=null}}})];return u}),define("admin/sales/controllers/adminSalesUserOrderController",["underscore","angular","framework/class","framework/assert","framework/utils"],function(e,r,s,n,t){var i=["$scope","orderService",s.create(function(e,s){this.$scope=t.extend(e,r.copy(this.$scope),!0),this.orderService=s,this.initialize()},{$scope:{activeUserOrder:null,userOrder:null,isActivatedByIdentityCard:!1,orderedBoxes:null,state:{isUpdating:!1}},orderService:null,initialize:function(){this.$scope.purchaseOrder=e.bind(this.purchaseOrder,this),this.$scope.undoPurchaseOrder=e.bind(this.undoPurchaseOrder,this),this.$scope.close=e.bind(this.close,this),this.$scope.$watch("activeUserOrder",e.bind(this.onActiveUserOrderChanged,this))},onActiveUserOrderChanged:function(e){return e?(this.$scope.userOrder=e.userOrder,this.$scope.isActivatedByIdentityCard=e.isActivatedByIdentityCard,this.$scope.orderedBoxes=this.orderService.groupOrdersByBoxes(this.$scope.userOrder.orders),void 0):(this.close(),void 0)},purchaseOrder:function(){this.$scope.state.isUpdating=!0;var r=this.$scope.userOrder,s=this.$scope.onPurchaseOrder({userOrder:r});s.then(e.bind(function(){this.$scope.onClose()},this)),s.finally(e.bind(function(){this.$scope.state.isUpdating=!1},this))},undoPurchaseOrder:function(){this.$scope.state.isUpdating=!0;var r=this.$scope.userOrder,s=this.$scope.onUndoPurchaseOrder({userOrder:r});s.then(e.bind(function(){this.$scope.onClose()},this)),s.finally(e.bind(function(){this.$scope.state.isUpdating=!1},this))},close:function(){this.$scope.onClose()}})];return i}),define("admin/sales/controllers/controllers",["angular","admin/sales/controllers/adminSalesController","admin/sales/controllers/adminSalesCoursesStatsController","admin/sales/controllers/adminSalesUsersOrdersController","admin/sales/controllers/adminSalesUserOrderController"],function(e,r,s,n,t){var i=[],o=e.module("lunchtime.admin.sales.controllers",i);return o.controller("adminSalesController",r),o.controller("adminSalesCoursesStatsController",s),o.controller("adminSalesUsersOrdersController",n),o.controller("adminSalesUserOrderController",t),o}),define("admin/sales/models/orderedCourseStats",["framework/assert"],function(e){var r=function(r,s,n){e.isNotNull(r,"course"),e.isNumber(s,"ordersLeft"),e.isNumber(n,"totalOrders"),this.course=r,this.ordersLeft=s,this.totalOrders=n};return r}),define("admin/sales/models/salesStats",["framework/assert"],function(e){var r=function(r,s){e.isNumber(r,"ordersPurchased"),e.isNumber(s,"totalOrders"),this.ordersPurchased=r,this.totalOrders=s};return r}),define("admin/sales/services/adminSalesService",["underscore","framework/assert","framework/utils","admin/sales/models/orderedCourseStats","admin/sales/models/salesStats"],function(e,r,s,n,t){var i=[function(){return{getOrderedCoursesStats:function(s){r.isArray(s,"usersOrders");var t={};e.each(s,function(r){e.each(r.orders,function(e){var s=e.course,i=t[s.id];i||(i=new n(s,0,0),t[s.id]=i),i.totalOrders+=e.quantity,r.isPurchased||(i.ordersLeft+=e.quantity)})});var i=e.values(t);return i},getSalesStats:function(s){r.isArray(s,"usersOrders");var n=0,i=s.length;e.each(s,function(e){e.isPurchased&&n++});var o=new t(n,i);return o},getPurchasedUsersOrders:function(s){r.isArray(s,"usersOrders");var n=e.filter(s,function(e){return e.isPurchased});return n},getNotPurchasedUsersOrders:function(s){r.isArray(s,"usersOrders");var n=e.filter(s,function(e){return!e.isPurchased});return n},getUserOrderByIdentityNumber:function(n,t){r.isArray(n,"usersOrders"),r.isNotNull(t,"identityNumber");var i=e.find(n,function(e){return s.string.equalsIgnoreCase(e.user.identityNumber,t)});return i},convertToIdentityNumber:function(e){for(var r=Number(e).toString(16),s=r.length;10>s;s++)r="0"+r;return r}}}];return i}),define("admin/sales/services/adminSalesApiService",["underscore","angular","moment","framework/assert","framework/utils"],function(e,r,s,n){var t=["$http","$q","admin.config","adminSalesApiMappingService","adminSalesQueueApiService",function(e,r,t,i,o){var u=t.urls.api.sales;return{getUsersOrders:function(t){n.isNotNull(t,"date");var o=r.defer(),a={params:{date:s(t).format("YYYY-MM-DD")}};return e.get(u.getUsersOrders,a).success(function(e){n.isNotNull(e,"reponse");var r=i.mapResponseToSalesData(e);o.resolve(r)}).error(function(e){o.reject(e)}),o.promise},purchaseOrder:function(e,t){n.isNotNull(e,"userOrder"),n.isNotNull(t,"date"),e.isPurchased&&r.when(e);var i=(r.defer(),{OrderId:e.id,Date:s(t).format("YYYY-MM-DD")});return o.enqueue(u.purchaseOrder,i),e.isPurchased=!0,r.when(e)},undoPurchaseOrder:function(e,t){n.isNotNull(e,"userOrder"),n.isNotNull(t,"date"),e.isPurchased||r.when(e),r.defer();var i={OrderId:e.id,Date:s(t).format("YYYY-MM-DD")};return o.enqueue(u.undoPurchaseOrder,i),e.isPurchased=!1,r.when(e)},removeOrder:function(t,i){n.isNotNull(t,"userOrder"),n.isNotNull(i,"date");var o=r.defer(),a={OrderId:t.id,Date:s(i).format("YYYY-MM-DD")};return e.post(u.undoPurchaseOrder,a).success(function(){o.resolve(t)}).error(function(e){o.reject(e)}),o.promise}}}];return t}),define("common/models/user",["framework/assert"],function(e){var r=function(r,s,n){e.isNotNull(r,"id"),e.isNotNull(s,"name"),e.isNotNull(n,"identityNumber"),this.id=r,this.name=s,this.identityNumber=n};return r}),define("admin/sales/models/userOrder",["framework/assert"],function(e){var r=function(r,s,n,t){e.isNotNull(r,"id"),e.isNotNull(s,"user"),e.isArray(n,"orders"),this.id=r,this.user=s,this.orders=n,this.isPurchased=t||!1};return r}),define("admin/sales/models/salesData",["framework/assert"],function(e){var r=function(r,s){e.isNotNull(r,"date"),e.isArray(s,"usersOrders"),this.date=r,this.usersOrders=s};return r}),define("admin/sales/services/adminSalesApiMappingService",["underscore","moment","framework/assert","common/models/user","common/models/order","admin/sales/models/userOrder","admin/sales/models/salesData"],function(e,r,s,n,t,i,o){var u=["commonApiMappingService",function(u){return{mapResponseToSalesData:function(n){s.isNotNull(n,"response"),s.isNotNull(n.Date,"response.Date"),s.isArray(n.UsersOrders,"response.UsersOrders");var t=r(n.Date).toDate(),i={},u=e.map(n.UsersOrders,function(e){return this.mapResponseToUserOrder(e,i)},this),a=new o(t,u);return a},mapResponseToUserOrder:function(r,o){s.isNotNull(r,"response"),s.isNotNull(r.OrderID,"response.OrderID"),s.isNotNull(r.UserID,"response.UserID"),s.isNotNull(r.UserName,"response.UserName"),s.isArray(r.Orders,"response.Orders");var a=r.OrderID,c=new n(r.UserID,r.UserName,r.UserIdentityNumber||""),l=r.IsPurchased||!1,d=e.map(r.Orders,function(e){s.isNotNull(e,"orderData"),s.isNotNull(e.Course,"orderData.Course");var r=o[e.Course.ID];r||(r=u.mapResponseToCourse(e.Course),o[r.id]=r),s.isNotNull(r,"course");var n=new t(e.Course.OrderItemID,r,e.Quantity,e.Course.Boxindex);return n}),m=new i(a,c,d,l);return m}}}];return u}),define("admin/sales/services/adminSalesCardReaderService",["framework/assert"],function(e){var r=["$document","$window","$rootScope","$timeout","admin.events",function(r,s,n,t,i){var o="",u=1e3,a=null,c=600,l=0,d=function(e){return null==e.which?e.keyCode<32?null:String.fromCharCode(e.keyCode):0!=e.which&&0!=e.charCode?e.which<32?null:String.fromCharCode(e.which):null};return{listen:function(){r.on("keypress",function(e){if(e=e||s.event,!(e.ctrlKey||e.altKey||e.metaKey)){var r=d(e||window.event);if(r){var m=new Date;m-l>c&&(l=0,o=""),o+=r,10==o.length&&(a||(n.$broadcast(i.sales.cardReader.input,o),a=t(function(){a=null},u)),l=0,o=""),l=m}}})},onInput:function(r){e.isFunction(r,"handler"),n.$on(i.sales.cardReader.input,r)}}}];return r}),define("admin/sales/services/adminSalesQueueApiService",["underscore","framework/assert"],function(e,r){var s=["$http","$timeout",function(s,n){var t=5,i=3e3,o=6e4;return{isSubmitting:!1,queue:[],attempsCount:0,timeoutPromise:null,enqueue:function(e,s){r.isNotNull(e,"url"),this.attempsCount=0,this.queue.push({url:e,data:s}),this.isSubmitting||this._submitQueue()},_submitQueue:function(){if(0!==this.queue.length){this.timeoutPromise&&(n.cancel(this.timeoutPromise),this.timeoutPromise=null),this.isSubmitting=!0;var r=this.queue[0];s.post(r.url,r.data).success(e.bind(this._onSubmitted,this)).error(e.bind(this._onSubmitFailed,this))}},_onSubmitted:function(){this.isSubmitting=!1,this.attempsCount=0,this.queue=this.queue.slice(1),this._submitQueue()},_onSubmitFailed:function(r,s){0===s?(this.isSubmitting=!1,this.attempsCount++,this.attempsCount>=t?(this.attempsCount=0,this.timeoutPromise=n(e.bind(this._submitQueue,this),o)):this.timeoutPromise=n(e.bind(this._submitQueue,this),i)):this._onSubmitted()}}}];return s}),define("admin/sales/services/adminSalesDateWatcherService",["underscore"],function(e){var r=["$interval","$route",function(r,s){var n=6e4;return{intervalPromise:null,date:null,watch:function(){this.date=new Date,this.intervalPromise=r(e.bind(this._checkDate,this),n)},dispose:function(){this.date=null,this.intervalPromise&&(r.cancel(this.intervalPromise),this.intervalPromise=null)},_checkDate:function(){var e=new Date,r=e.getDate()!==this.date.getDate()||e.getMonth()!==this.date.getMonth()||e.getFullYear()!==this.date.getFullYear();r&&(this.date=e,s.reload())}}}];return r}),define("admin/sales/services/services",["angular","admin/sales/services/adminSalesService","admin/sales/services/adminSalesApiService","admin/sales/services/adminSalesApiMappingService","admin/sales/services/adminSalesCardReaderService","admin/sales/services/adminSalesQueueApiService","admin/sales/services/adminSalesDateWatcherService"],function(e,r,s,n,t,i,o){var u=[],a=e.module("lunchtime.admin.sales.services",u);return a.service("adminSalesService",r),a.service("adminSalesApiService",s),a.service("adminSalesApiMappingService",n),a.service("adminSalesCardReaderService",t),a.service("adminSalesQueueApiService",i),a.service("adminSalesDateWatcherService",o),a}),define("admin/sales/filters/filters",["angular"],function(e){var r=[],s=e.module("lunchtime.admin.sales.filters",r);return s}),define("admin/sales/directives/adminSalesCoursesStats",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/admin/sales/courses-stats.tmpl",scope:{date:"=",coursesStats:"="},controller:"adminSalesCoursesStatsController"}}];return e}),define("admin/sales/directives/adminSalesUsersOrders",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/admin/sales/users-orders.tmpl",scope:{date:"=",usersOrders:"=",onPurchaseOrder:"&",onUndoPurchaseOrder:"&",onRemoveOrder:"&"},controller:"adminSalesUsersOrdersController"}}];return e}),define("admin/sales/directives/adminSalesUserOrder",[],function(){var e=[function(){return{restrict:"AE",templateUrl:"/template/admin/sales/user-order.tmpl",scope:{activeUserOrder:"=",onPurchaseOrder:"&",onUndoPurchaseOrder:"&",onClose:"&"},controller:"adminSalesUserOrderController"}}];return e}),define("admin/sales/directives/directives",["angular","admin/sales/directives/adminSalesCoursesStats","admin/sales/directives/adminSalesUsersOrders","admin/sales/directives/adminSalesUserOrder"],function(e,r,s,n){var t=[],i=e.module("lunchtime.admin.sales.directives",t);return i.directive("ltAdminSalesCoursesStats",r),i.directive("ltAdminSalesUsersOrders",s),i.directive("ltAdminSalesUserOrder",n),i}),define("admin/sales/providers/providers",["angular"],function(e){var r=[],s=e.module("lunchtime.admin.sales.providers",r);return s}),define("admin/sales/templates/templates",["angular"],function(e){var r=[],s=e.module("lunchtime.admin.sales.templates",r);return s.run(["$templateCache",function(){}]),s}),define("admin/sales/sales.start",[],function(){var e={initializeCardReader:["adminSalesCardReaderService",function(e){e.listen()}]};return e}),define("admin/sales/sales",["angular","admin/sales/controllers/controllers","admin/sales/services/services","admin/sales/filters/filters","admin/sales/directives/directives","admin/sales/providers/providers","admin/sales/templates/templates","admin/sales/sales.start"],function(e,r,s,n,t,i,o,u){var a=[r.name,s.name,n.name,t.name,i.name,o.name],c=e.module("lunchtime.admin.sales",a);return c.run(u.initializeCardReader),c}),define("admin/admin",["angular","common/common","admin/admin.config","admin/admin.routes","admin/admin.events","admin/menu/menu","admin/sales/sales"],function(e,r,s,n,t,i,o){var u=[r.name,i.name,o.name],a=e.module("lunchtime.admin",u);return a.constant("admin.config",s),a.constant("admin.events",t),a.config(n),a}),define("application",["angular","application.config","application.routes","application.providers","application.start","angular-route","angular-sanitize","angular-bootstrap","core/core","common/common","user/user","admin/admin"],function(e,r,s,n,t,i,o,u,a,c,l,d){var m=["ngRoute","ngSanitize","ui.bootstrap",a.name,c.name,l.name,d.name],p=e.module("lunchtime.application",m);return p.constant("config",r),p.config(s),p});
//# sourceMappingURL=LunchTime.min.js.map